# React의 useState 훅 내부 작동 방식

React의 `useState` 훅은 컴포넌트에 상태를 추가하는 핵심 기능입니다. 이 훅의 내부 작동 방식을 이해하면 React의 상태 관리 메커니즘을 더 깊이 이해할 수 있습니다.

## 1. useState의 기본 흐름

1. **마운트 (초기 렌더링)**

   - 컴포넌트가 처음 렌더링될 때 `mountState` 함수가 호출됩니다.
   - 새로운 훅 객체가 생성되고, 초기 상태값이 설정됩니다.
   - 상태 업데이트를 위한 큐(queue)가 생성됩니다.

2. **상태 업데이트 (setState 호출)**

   - `dispatchSetState` 함수가 호출됩니다.
   - 업데이트 객체가 생성되고 큐에 추가됩니다.
   - 리렌더링이 스케줄링됩니다.

3. **리렌더링**
   - `updateState` 함수가 호출됩니다.
   - 큐에 있는 모든 업데이트가 처리됩니다.
   - 새로운 상태가 계산되고 컴포넌트가 리렌더링됩니다.

## 2. 주요 내부 메커니즘

### 업데이트 큐 (Update Queue)

[React 공식 문서 - Queueing a series of state updates](https://react.dev/learn/queueing-a-series-of-state-updates)

- 각 상태 업데이트는 즉시 처리되지 않고 큐에 추가됩니다.
- 이를 통해 React는 여러 업데이트를 배치 처리할 수 있습니다.

### 우선순위 관리 (Lanes)

- 각 업데이트에는 우선순위(lane)가 할당됩니다.
- 우선순위에 따라 업데이트 처리 순서가 결정됩니다.

### 조정 (Reconciliation)

- 리렌더링 시 React는 이전 상태와 새 상태를 비교합니다.
- 변경된 부분만 실제 DOM에 반영합니다.

## 3. 주의사항 및 특징

### 비동기적 업데이트

- `setState` 호출 직후 상태 변수를 읽으면 여전히 이전 값을 반환합니다.
- 실제 상태 업데이트는 다음 렌더링 사이클에서 이루어집니다.

### 동일한 값으로의 업데이트

- 같은 값으로 상태를 업데이트해도 리렌더링이 발생할 수 있습니다.
- 이는 React의 내부 최적화 메커니즘 때문입니다.

### 배치 업데이트

- React는 여러 상태 업데이트를 배치로 처리합니다.
- 이는 불필요한 리렌더링을 방지하고 성능을 향상시킵니다.

## React의 핵심 루프

React의 상태 관리는 다음과 같은 핵심 루프를 따릅니다:

1. **마운트 (Mount)**:

   - 컴포넌트가 처음 렌더링될 때 DOM 노드를 생성하고 페이지에 삽입합니다.

2. **트리거 (Trigger)**:

   - 상태 변경 함수(예: `setCount`)가 호출되어 상태가 업데이트됩니다.

3. **렌더 (Render)**:

   - 상태 변경으로 컴포넌트 함수가 다시 호출되어 새로운 UI 설명(React 엘리먼트)을 생성합니다.

4. **조정 (Reconciliation)**:

   - React는 이전 스냅샷과 새 스냅샷을 비교하여 변경 사항을 파악합니다.

5. **커밋 (Commit)**:
   - 필요한 DOM 업데이트를 수행합니다.
