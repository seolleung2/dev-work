# React의 참조 동등성과 상태 변경 감지

React가 상태 변경을 감지하는 방식을 이해하는 것은 중요합니다. 이는 "참조 동등성(referential equality)"이라는 개념과 밀접하게 관련되어 있습니다.

## 참조 동등성이란?

참조 동등성은 두 변수가 메모리 상의 동일한 객체를 가리키고 있는지를 비교하는 것입니다.

- JavaScript에서 `===` 연산자는 객체나 배열을 비교할 때 참조 동등성을 사용합니다.
- 두 객체나 배열이 같은 내용을 가지고 있더라도, 다른 메모리 위치에 저장되어 있다면 다른 것으로 간주됩니다.

## React에서의 상태 변경 감지

React는 상태가 변경되었는지 확인하기 위해 참조 동등성을 사용합니다:

1. `setState` 함수 (또는 `useState`의 setter 함수)가 호출될 때마다 React는 새로운 상태 값과 이전 상태 값을 비교합니다.
2. 이 비교는 `===` 연산자를 사용하여 수행됩니다.
3. 만약 새 상태 값이 이전 상태 값과 참조적으로 동일하다면, React는 상태가 변경되지 않았다고 판단하고 재렌더링을 수행하지 않습니다.

## 배열 변경(Mutation)의 문제점

배열을 직접 변경할 때 발생하는 문제:

```javascript
const colors = ["red", "blue"];
colors[1] = "green";
```

- 이 경우, `colors` 배열의 내용은 변경되었지만, `colors` 변수는 여전히 동일한 배열 객체를 가리킵니다.
- React의 관점에서 `colors === colors`는 여전히 `true`입니다.
- 따라서 React는 상태가 변경되지 않았다고 판단하고 컴포넌트를 재렌더링하지 않습니다.

## 올바른 방법: 새 배열 생성

새로운 배열을 생성하여 상태를 업데이트하는 방법:

```javascript
const colors = ["red", "blue"];
const newColors = [...colors];
newColors[1] = "green";
setColors(newColors);
```

- 이 방법은 새로운 배열 객체를 생성합니다.
- `newColors !== colors`는 `true`입니다.
- React는 이를 상태 변경으로 인식하고 컴포넌트를 재렌더링합니다.

## 결론

- React의 상태 관리 시스템은 참조 동등성에 의존합니다.
- 배열이나 객체를 직접 변경하는 것은 React의 상태 변경 감지 메커니즘을 우회합니다.
- 항상 새로운 객체나 배열을 생성하여 상태를 업데이트하는 것이 안전하고 예측 가능한 방법입니다.
